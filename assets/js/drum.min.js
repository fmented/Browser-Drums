function openFullscreen(){elem.requestFullscreen?elem.requestFullscreen():elem.mozRequestFullScreen?elem.mozRequestFullScreen():elem.webkitRequestFullscreen?elem.webkitRequestFullscreen():elem.msRequestFullscreen&&elem.msRequestFullscreen()}function pageInit(){var e=(screen.orientation||{}).type||screen.mozOrientation||screen.msOrientation;e.includes("landscape")?(rotation=0,sheight=window.innerHeight,swidth=window.innerWidth,ratio=sheight/swidth,big=45*sheight/100,medium=38*sheight/100,small=30*sheight/100,xbig=52*sheight/100,pos={crash1:{x:1*swidth/100+ratio,y:-8*sheight/100+ratio},crash2:{x:40*swidth/100+ratio,y:-2*sheight/100+ratio},ride:{x:72*swidth/100+ratio,y:-5*sheight/100+ratio},openhat:{x:3*swidth/100+ratio,y:30*sheight/100+ratio},closehat:{x:1*swidth/100+ratio,y:60*sheight/100+ratio},snare:{x:36*swidth/100+ratio,y:35*sheight/100+ratio},tom1:{x:25*swidth/100+ratio,y:20*sheight/100+ratio},tom2:{x:55*swidth/100+ratio,y:20*sheight/100+ratio},floor:{x:72*swidth/100+ratio,y:42*sheight/100+ratio},kick:{x:20*swidth/100+ratio,y:55*sheight/100+ratio},kick2:{x:50*swidth/100+ratio,y:55*sheight/100+ratio},textmode:{x:88*swidth/100+ratio,y:93*sheight/100+ratio}}):(rotation=90,sheight=window.innerHeight,swidth=window.innerWidth,ratio=swidth/sheight,big=45*swidth/100,medium=38*swidth/100,small=30*swidth/100,xbig=52*swidth/100,pos={crash1:{x:1*sheight/100+ratio,y:-108*swidth/100+ratio},crash2:{x:40*sheight/100+ratio,y:-102*swidth/100+ratio},ride:{x:72*sheight/100+ratio,y:-105*swidth/100+ratio},openhat:{x:3*sheight/100+ratio,y:-70*swidth/100+ratio},closehat:{x:1*sheight/100+ratio,y:-40*swidth/100+ratio},snare:{x:36*sheight/100+ratio,y:-65*swidth/100+ratio},tom1:{x:25*sheight/100+ratio,y:-80*swidth/100+ratio},tom2:{x:55*sheight/100+ratio,y:-80*swidth/100+ratio},floor:{x:72*sheight/100+ratio,y:-58*swidth/100+ratio},kick:{x:20*sheight/100+ratio,y:-45*swidth/100+ratio},kick2:{x:50*sheight/100+ratio,y:-45*swidth/100+ratio},textmode:{x:88*sheight/100+ratio,y:-7*swidth/100+ratio}})}function loadCanvas(e,i){var t={},a=0,o=0;for(var s in e)o++;for(var s in e)t[s]=new Image,t[s].onload=function(){++a>=o&&i(t)},t[s].src=e[s]}function buildStage(e){function i(){m.forEach(function(e){e.off("mousedown touchstart mouseup touchend"),e.on("mousedown touchstart",function(){lowLag.play(e.attrs.audio),e.scale({x:1.05,y:1.05}),layer.draw()}),e.on("mouseup touchend",function(){e.scale({x:1,y:1}),layer.draw()})})}var t=new Konva.Image({image:e.crash1,x:pos.crash1.x,y:pos.crash1.y,audio:audio.crash1,width:xbig,height:xbig,keyBind:key.crash1}),a=new Konva.Image({image:e.crash2,x:pos.crash2.x,y:pos.crash2.y,audio:audio.crash2,width:big,height:big,keyBind:key.crash2}),o=new Konva.Image({image:e.ride,x:pos.ride.x,y:pos.ride.y,audio:audio.ride,width:xbig,height:xbig,keyBind:key.ride}),s=new Konva.Image({image:e.openhat,x:pos.openhat.x,y:pos.openhat.y,audio:audio.openhat,width:medium,height:medium,keyBind:key.openhat}),n=new Konva.Image({image:e.closehat,x:pos.closehat.x,y:pos.closehat.y,audio:audio.closehat,width:medium,height:medium,keyBind:key.closehat}),r=new Konva.Image({image:e.snare,x:pos.snare.x,y:pos.snare.y,audio:audio.snare,width:xbig,height:xbig,keyBind:key.snare}),h=new Konva.Image({image:e.tom1,x:pos.tom1.x,y:pos.tom1.y,audio:audio.tom1,width:medium,height:medium,keyBind:key.tom1}),d=new Konva.Image({image:e.tom2,x:pos.tom2.x,y:pos.tom2.y,audio:audio.tom2,width:big,height:big,keyBind:key.tom2}),c=new Konva.Image({image:e.floor,x:pos.floor.x,y:pos.floor.y,audio:audio.floor,width:xbig,height:xbig,keyBind:key.floor}),g=new Konva.Image({image:e.kick,x:pos.kick.x,y:pos.kick.y,audio:audio.kick,width:xbig,height:xbig,keyBind:key.kick}),l=new Konva.Image({image:e.kick2,x:pos.kick2.x,y:pos.kick2.y,audio:audio.kick2,width:xbig,height:xbig,keyBind:key.kick2}),u=new Konva.Text({x:pos.textmode.x,y:pos.textmode.y,fontFamily:"Calibri",fontSize:20,text:"mode : play",fill:"white"}),m=[n,c,s,g,l,r,h,d,t,a,o],y=!1;u.on("click tap",function(){y?(y=!y,m.forEach(function(e){e.off("click tap dblclick dbltap"),e.draggable(!1)}),i(),this.text(""),layer.draw(),this.text("mode : play"),layer.draw()):(y=!y,m.forEach(function(e){e.draggable(!0)}),m.forEach(function(e){e.off("mousedown touchstart mouseup touchend"),e.on("click tap",function(){e.moveToTop(),u.moveToTop(),layer.draw()}),e.on("dblclick dbltap",function(){e.moveToBottom(),u.moveToTop(),layer.draw()})}),this.text(""),layer.draw(),this.text("mode : edit"),layer.draw())}),u.on("dblclick dbltap",function(){openFullscreen()}),m.forEach(function(e){e.cache(),e.drawHitFromCache(),layer.add(e)}),layer.add(u),stage.add(layer),i()}var sheight,swidth,ratio,rotation,big,big2,medium,medium2,small,small2,xbig,xbig2,pos,lowLag=window.lowLag;lowLag.debug="shutup!",lowLag.init();var stage,elem=document.documentElement,audio={crash1:"assets/audio/crash1.wav",crash2:"assets/audio/crash2.wav",ride:"assets/audio/ride.wav",openhat:"assets/audio/hh-open.wav",closehat:"assets/audio/hh-close.wav",snare:"assets/audio/snare.wav",tom1:"assets/audio/tom-hi.wav",tom2:"assets/audio/tom-lo.wav",floor:"assets/audio/floor.wav",kick:"assets/audio/kick.wav",kick2:"assets/audio/kick.wav"};key={crash1:[69,87,81],crash2:[84,89],ride:[73,79],openhat:[65,83],closehat:[88,90],snare:[71,72,74],tom1:[68,70],tom2:[75,76],floor:[188,190],kick:[86],kick2:[66,78]},pageInit(),stage=new Konva.Stage({container:"container",rotation:rotation,width:swidth,height:sheight});var container=stage.container();container.tabIndex=1,container.focus();var lastplay=[];container.addEventListener("keydown",function(e){if(13===e.keyCode)openFullscreen();else try{stage.children[0].children.forEach(function(i){lastplay.includes(e.keyCode)||i.attrs.keyBind.includes(e.keyCode)&&(i.fire("touchstart"),lastplay.push(e.keyCode))})}catch(i){i.name==TypeError&&stage.children[0].children.forEach(function(i){lastplay.includes(e.keyCode)||i.attrs.keyBind.includes(e.keyCode)&&(i.fire("touchstart"),lastplay.push(e.keyCode))})}}),container.addEventListener("keyup",function(e){try{stage.children[0].children.forEach(function(i){if(i.attrs.keyBind.includes(e.keyCode)){i.fire("touchend");var t=lastplay.indexOf(e.keyCode);delete lastplay[t]}})}catch(i){i.name==TypeError&&stage.children[0].children.forEach(function(i){if(i.attrs.keyBind.includes(e.keyCode)){i.fire("touchend");var t=lastplay.indexOf(e.keyCode);delete lastplay[t]}})}});var layer=new Konva.Layer({}),sources={openhat:"assets/image/x-hat-o.png",crash1:"assets/image/x-crash.png",closehat:"assets/image/x-hat-c.png",kick:"assets/image/x-kick.png",kick2:"assets/image/x-kick.png",crash2:"assets/image/x-crash.png",ride:"assets/image/x-ride.png",tom1:"assets/image/x-tom.png",tom2:"assets/image/x-tom.png",snare:"assets/image/x-snare.png",floor:"assets/image/x-tom.png"};window.addEventListener("load",function(){for(var e in audio)lowLag.load(audio[e]);loadCanvas(sources,buildStage)}),window.addEventListener("resize",function(){stage.destroy(),pageInit(),stage=new Konva.Stage({container:"container",rotation:rotation,width:swidth,height:sheight}),loadCanvas(sources,buildStage)}),window.addEventListener("orientationchange",function(){stage.destroy(),pageInit(),stage=new Konva.Stage({container:"container",rotation:rotation,width:swidth,height:sheight}),loadCanvas(sources,buildStage)});