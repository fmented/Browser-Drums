window.console||(console={log:function(){}});var lowLag=new function(){this.someVariable=void 0,this.showNeedInit=function(){lowLag.msg("lowLag: you must call lowLag.init() first!")},this.load=this.showNeedInit,this.play=this.showNeedInit,this.useSuspension=!1,this.suspendDelay=1e4,this.suspendTimeout=null,this.suspended=!1,this.audioTagTimeToLive=5e3,this.sm2url="sm2/swf/",this.soundUrl="",this.debug="console",this.divLowLag=null,this.divDebug=null,this.createElement=function(o,e){var t=document.createElement(o);if(e)for(var n in e)t.setAttribute(n,e[n]);return t},this.safelyRemoveElement=function(o){o&&o.parentNode.removeChild(o)},this.safelyRemoveElementById=function(o){this.safelyRemoveElement(document.getElementById(o))},this.ready=function(o){"loading"!=document.readyState?o():document.addEventListener?document.addEventListener("DOMContentLoaded",o):document.attachEvent("onreadystatechange",function(){"loading"!=document.readyState&&o()})},this.init=function(o){this.safelyRemoveElement(this.divLowLag),this.divLowLag=this.createElement("div",{id:"lowLag"}),document.body.appendChild(this.divLowLag);var e=void 0;null!=o&&(null!=o.force&&(e=o.force),null!=o.audioTagTimeToLive&&(lowLag.audioTagTimeToLive=o.audioTagTimeToLive),null!=o.sm2url&&(lowLag.sm2url=o.sm2url),null!=o.urlPrefix&&(lowLag.soundUrl=o.urlPrefix),null!=o.debug&&(lowLag.debug=o.debug),null!=o.useSuspension&&(lowLag.useSuspension=o.useSuspension),null!=o.suspendDelay&&(lowLag.suspendDelay=o.suspendDelay)),"screen"!=lowLag.debug&&"both"!=lowLag.debug||(lowLag.divDebug=lowLag.createElement("pre"),lowLag.divLowLag.appendChild(lowLag.divDebug));var t="sm2";switch(null!=e?t=e:window.AudioContext||window.webkitAudioContext?t="audioContext":-1!=navigator.userAgent.indexOf("Firefox")&&(t="audioTag"),t){case"audioContext":this.msg("init audioContext"),this.load=this.loadSoundAudioContext,this.play=this.playSoundAudioContext,this.audioContext||(this.audioContext=new(window.AudioContext||window.webkitAudioContext)),(this.useSuspension&="suspend"in lowLag.audioContext&&"onended"in lowLag.audioContext.createBufferSource())&&(this.playingQueue=[],this.suspendPlaybackAudioContext());break;case"audioTag":this.msg("init audioTag"),this.load=this.loadSoundAudioTag,this.play=this.playSoundAudioTag;break;case"sm2":this.msg("init SoundManager2"),this.load=this.loadSoundSM2,this.play=this.playSoundSM2,lowLag.msg("loading SM2 from "+lowLag.sm2url),soundManager.setup({url:lowLag.sm2url,useHighPerformance:!0,onready:lowLag.sm2Ready,debugMode:!0})}},this.sm2IsReady=!1,this.sm2ToLoad=[],this.loadSoundSM2=function(o,e){lowLag.sm2IsReady?lowLag.loadSoundSM2ForReals(o,e):lowLag.sm2ToLoad.push([o,e])},this.loadSoundSM2ForReals=function(o,e){var t=lowLag.getTagFromURL(o,e);lowLag.msg("sm2 loading "+o+" as tag "+t);o=lowLag.getURLArray(o);for(var n=0;n<o.length;n++){var a=lowLag.soundUrl+o[n];o[n]=a}soundManager.createSound({id:t,autoLoad:!0,url:o})},this.sm2Ready=function(){lowLag.sm2IsReady=!0;for(var o=0;o<lowLag.sm2ToLoad.length;o++){var e=lowLag.sm2ToLoad[o];lowLag.loadSoundSM2ForReals(e[0],e[1])}lowLag.sm2ToLoad=[]},this.playSoundSM2=function(o){lowLag.msg("playSoundSM2 "+o),soundManager.play(o)},this.getTagFromURL=function(o,e){return null!=e?e:lowLag.getSingleURL(o)},this.getSingleURL=function(o){return"string"==typeof o?o:o[0]},this.getURLArray=function(o){return"string"==typeof o?[o]:o},this.audioContextPendingRequest={},this.audioContext=void 0,this.audioBuffers={},this.loadSoundAudioContext=function(o,e,t){function n(o){lowLag.audioBuffers[e]=o,lowLag.audioContextPendingRequest[e]&&lowLag.playSoundAudioContext(e)}function a(o){lowLag.msg("Error loading webkit/chrome audio: "+o)}t||(t=lowLag.soundUrl);var i=lowLag.getSingleURL(o);e=lowLag.getTagFromURL(o,e);lowLag.msg("webkit/chrome audio loading "+t+i+" as tag "+e);var u=new XMLHttpRequest;u.open("GET",t+i,!0),u.responseType="arraybuffer",u.onload=function(){var i=lowLag.audioContext.decodeAudioData(u.response,n,a);i&&"function"==typeof i.then&&i.then(n).catch(function(n){a(n),o.shift(),o.length>0&&lowLag.loadSoundAudioContext(o,e,t)})},u.send()},this.playSoundAudioContext=function(o){lowLag.msg("playSoundAudioContext "+o);var e=lowLag.audioBuffers[o];if(null!=e){var t=lowLag.audioContext;this.useSuspension&&this.suspended&&this.resumePlaybackAudioContext();var n=t.createBufferSource();n.buffer=e,n.connect(t.destination),"function"==typeof n.noteOn?n.noteOn(0):(this.useSuspension&&(this.playingQueue.push(o),n.onended=function(e){lowLag.hndlOnEndedAudioContext(o,e)}),n.start())}else lowLag.audioContextPendingRequest[o]=!0},this.hndlOnEndedAudioContext=function(o,e){for(var t=0;t<this.playingQueue.length;t++)if(this.playingQueue[t]==o){this.playingQueue.splice(t,1);break}this.playingQueue.length||this.suspendPlaybackAudioContext()},this.resumePlaybackAudioContext=function(){this.audioContext.resume(),this.suspended=!1},this.suspendPlaybackAudioContext=function(){this.suspendTimeout&&clearTimeout(this.suspendTimeout),this.suspendTimeout=setTimeout(function(){lowLag.audioContext.suspend(),lowLag.suspended=!0,lowLag.suspendTimeout=null},this.suspendDelay)},this.audioTagID=0,this.audioTagNameToElement={},this.loadSoundAudioTag=function(o,e){var t="lowLagElem_"+lowLag.audioTagID++;e=lowLag.getTagFromURL(o,e),o=lowLag.getURLArray(o);lowLag.audioTagNameToElement[e]=t,lowLag.msg("audioTag loading "+o+" as tag "+e);for(var n=this.createElement("audio",{id:t,preload:"auto",autobuffer:"autobuffer"}),a=0;a<o.length;a++){var i=o[a],u="audio/"+lowLag.getExtension(i),s=this.createElement("source",{src:lowLag.soundUrl+i,type:u});n.appendChild(s)}document.body.appendChild(n)},this.playSoundAudioTag=function(o){lowLag.msg("playSoundAudioTag "+o);var e=lowLag.audioTagNameToElement[o],t="lowLagCloneElem_"+lowLag.audioTagID++,n=document.getElementById(e),a=n.cloneNode(!0);a.setAttribute("id",t),this.divLowLag.appendChild(a),lowLag.msg(o),-1!=lowLag.audioTagTimeToLive&&setTimeout(function(){lowLag.safelyRemoveElement(a)},lowLag.audioTagTimeToLive),a.play()},this.getExtension=function(o){return o.substring(o.lastIndexOf(".")+1).toLowerCase()},this.msg=function(o){o="-- lowLag "+o,"both"!=lowLag.debug&&"console"!=lowLag.debug||console.log(o),lowLag.divDebug&&(lowLag.divDebug.innerHTML+=o+"\n")}};